# Dependencies command

Upload dependencies graph to Datadog in order to detect runtime vulnerabilities by Continuous Profiler.

## Usage

### Setup

You need to have `DATADOG_API_KEY` and `DATADOG_APP_KEY` in your environment.

```bash
# Environment setup
export DATADOG_API_KEY="<API KEY>"
export DATADOG_APP_KEY="<APP KEY>"
```

It is possible to configure the tool to use Datadog EU by defining the `DATADOG_SITE` environment variable to `datadoghq.eu`. By defaut the requests are sent to Datadog US. In order to send the usage metrics to the correct datacenter, the `DATADOG_API_HOST` must also be set if another instance of Datadog is used. For example, for Datadog EU, it should be set to `api.datadoghq.eu`.  

### Commands

#### `upload`

This command will upload dependencies graph to Datadog in order to detect runtime vulnerabilities by Continuous Profiler.

To upload the dependencies graph generated by the [snyk cli](https://github.com/snyk/snyk#cli), this command should be run: 

```bash
snyk test --print-deps --json > ./snyk_deps.json
datadog-ci dependencies upload ./snyk_deps.json --source snyk --service my-service --release-version 1.234
```

* The first positional argument is the path to file that contains dependency graph. The file should be generated by the `snyk test --print-deps --json` command.

* `--source` (required) should be set to `snyk` as currently it's the only integration we support.

* `--service` (required) should be set as the name of the service you're uploading dependencies graph for (the value should match the `service` tag set)

* `--release-version` (required) is similar to `--service` parameter and will be used to match the `version` tag set.

In addition, some optional parameters are available:

* `--dry-run` (default: `false`): it will run the command without the final step of upload. All other checks are performed.
